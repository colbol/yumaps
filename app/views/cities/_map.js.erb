<script>


$( document ).ready(function() {
  $('.info-container').hide();
});

arr = []

for (let s of geo.features) {
   arr.push(s.properties.FEDENAME)
}

$('.info-container').hide();


mapboxgl.accessToken = "pk.eyJ1Ijoic2FsaW1jaG9yZmkiLCJhIjoiY2o0azBlenFpMGV6ajJ3cWhmOWwzeHBzcyJ9.9kmFrJOa12m_9PxIvAJatQ"
var map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/salimchorfi/cj58ljlw553ep2tmn2rd6787s',
  center: [-73.694, 45.546],
zoom: 10.3 // starting zoom

});

// map.scrollZoom.disable();

var layerIDs = []; // Will contain a list used to filter against.
var filterInput = document.getElementById('filter-input');

map.on('load', function () {

  map.addSource("district", {
    "type": "geojson",
    "data": gon.json
  });

  map.addLayer({
    "id": "state-fills",
    "type": "fill",
    "source": "district",
    "layout": {},
    "paint": {
      "fill-color": "#627BC1",
      "fill-opacity": 0.2
    }
  });

  map.addLayer({
    "id": "state-borders",
    "type": "line",
    "source": "district",
    "layout": {},
    "paint": {
      "line-color": "#fff",
      "line-width": 1
    }
  });

  map.addLayer({
    "id": "state-fills-hover",
    "type": "fill",
    "source": "district",
    "layout": {},
    "paint": {
      "fill-color": "#627BC1",
      "fill-opacity": 1
    },
    "filter": ["==", "name", ""]
  });



  map.addLayer({
    "id": "neighbor",
    "type": "symbol",
    "source": "district",
    "layout": {
      "text-field": "{tag}",
      "text-size": 11,
    }
    // "paint": {
    //   "text-color": "white",
    // },

  });

  map.addLayer({
      "id": "filter-fills",
      "type": "fill",
      "source": "district",
      "layout": {},
      "paint": {
        "fill-color": "#fff",
        "fill-opacity": 1
      },
      "filter": ["==", "name", ""]
    });

  filterInput.addEventListener('keyup', function(e) {
        // If the input value matches a layerID set
        // it's visibility to 'visible' or else hide it.
        var value = e.target.value.trim().toLowerCase();
        var places = []
        gon.tags.forEach(function(tag) {
        if (value == tag.content) {
          places.push(tag.name);
        }
        });
        places.forEach(function(place) {
          console.log("fills-" + place)
          map.addLayer({
            "id": "fills-" + place,
            "type": "fill",
            "source": "district",
            "layout": {},
            "paint": {
              "fill-color": "#fff",
              "fill-opacity": 0.5
            },
            "filter": ["==", "FEDENAME", ""]
          });
          map.setFilter("fills-" + place, ["==", "FEDENAME", place]);
        });
    });


  map.on('click', 'state-fills', function (e) {

    $.ajax({
      url: "<%= @city.id %>/fetch_name",
      type: "post",
      data: {name: e.features[0].properties.FEDENAME, district_index: arr.indexOf(e.features[0].properties.FEDENAME)},
      success: function(){
        //alert('Saved Successfully');
      },
      error:function(){
       //alert('Error');
      }
    });

    console.log($('.temp_information').data('temp'))

    $('.info-container').show();


    var neighbor_name = e.features[0].properties.FEDENAME;
    $('#pop_up_name').html(neighbor_name);

  });

// Change the cursor to a pointer when the mouse is over the places layer.
map.on('mouseenter', 'state-fills', function () {
  map.getCanvas().style.cursor = 'pointer';
});

// Change it back to a pointer when it leaves.
map.on('mouseleave', 'state-fills', function () {
  map.getCanvas().style.cursor = '';
});
});



</script>
